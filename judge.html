<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Card Master V6 (Black/White)</title>
    <style>
        /* --- ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆå®šç¾© --- */
        body { 
            font-family: sans-serif; background: #000; color: #fff; margin: 0; 
            overflow: hidden; width: 100vw; height: 100dvh;
        }
        
        #app-container { 
            position: relative; width: 100%; height: 100%; max-width: 600px; margin: 0 auto;
        }

        video {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
            object-fit: cover; opacity: 0.4; transition: opacity 0.5s;
        }
        video.active { opacity: 1.0; }

        /* ç”»é¢ãƒ¬ã‚¤ãƒ¤ãƒ¼ */
        .screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column; align-items: center; 
            padding: 10px; box-sizing: border-box; z-index: 10;
            pointer-events: none; /* UIæ“ä½œã¯å­è¦ç´ ã§æœ‰åŠ¹åŒ– */
        }
        .screen > * { pointer-events: auto; }
        .hidden { display: none !important; }

        /* --- V6å°‚ç”¨ï¼šå¹¾ä½•å­¦æ¯”ç‡ã‚°ãƒªãƒƒãƒ‰ --- */
        /* ç‰©ç†å¹…åˆè¨ˆ = 63*4 + 20*3 = 312mm
           ã‚«ãƒ¼ãƒ‰å¹…ç‡ = 63 / 312 = 20.19%
           éš™é–“ç‡ = 20 / 312 = 6.41%
        */
        .slot-container {
            width: 100%; 
            /* ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”å›ºå®š (312 : 88) = é«˜ã•ã¯ãŠã‚ˆãå¹…ã®28% */
            height: 30vw; max-height: 200px; 
            margin-top: 20vh; /* ç”»é¢ä¸Šéƒ¨ã‹ã‚‰ã®ä½ç½® */
            display: flex; 
            justify-content: space-between; /* ä¸¡ç«¯æƒãˆ */
            align-items: center;
        }
        
        .slot {
            width: 20.2%; /* è¨ˆç®—ã•ã‚ŒãŸç‰©ç†æ¯”ç‡ */
            height: 100%; 
            border: 2px solid #0f0; 
            background: rgba(255,255,255,0.1);
            box-sizing: border-box;
            border-radius: 4px;
            position: relative;
        }
        /* æ ç•ªå·ã¨èªè­˜çµæœã®è¡¨ç¤º */
        .slot-info {
            position: absolute; bottom: -20px; left: 0; width: 100%;
            text-align: center; font-size: 10px; color: #0f0; text-shadow: 0 1px 2px #000;
        }

        /* --- UIãƒ‘ãƒ¼ãƒ„ --- */
        h1 { font-size: 2rem; margin-top: 20%; color: #fff; text-shadow: 0 0 10px #fff; }
        
        /* ã‚¿ã‚¤ãƒˆãƒ«ç”»é¢ã®ãƒªã‚¹ãƒˆ */
        #level-list {
            width: 90%; flex: 1; overflow-y: auto; margin-top: 20px;
        }
        .level-item {
            background: #222; border: 1px solid #444; color: white;
            padding: 15px; margin-bottom: 8px; border-radius: 8px;
            display: flex; justify-content: space-between; align-items: center;
            cursor: pointer;
        }

        /* ãƒœã‚¿ãƒ³ */
        .btn-main {
            padding: 15px 40px; font-size: 1.2rem; font-weight: bold;
            background: #007bff; color: white; border: none; border-radius: 50px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
        }
        .judge-btn {
            position: absolute; bottom: 50px; width: 80%;
            background: linear-gradient(to bottom, #28a745, #1e7e34);
        }

        /* è¨­å®šç”»é¢ */
        #settings-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #111; z-index: 100; transform: translateY(100%);
            transition: transform 0.3s; padding: 20px; overflow-y: auto;
        }
        #settings-overlay.open { transform: translateY(0); }
        
        .setting-box { background: #222; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
        .card-list { display: flex; overflow-x: auto; gap: 10px; padding: 10px 0; }
        .card-thumb { 
            min-width: 60px; height: 80px; background: #fff; 
            border: 1px solid #ccc; position: relative;
            display: flex; align-items: center; justify-content: center;
        }
        .card-thumb img { width: 100%; height: 100%; object-fit: contain; filter: grayscale(100%) contrast(150%); }

        /* çµæœè¡¨ç¤º */
        #result-view {
            position: fixed; top:0; left:0; width:100%; height:100%;
            background: rgba(0,0,0,0.9); display: none; z-index: 200;
            flex-direction: column; justify-content: center; align-items: center;
        }

        /* 2å€¤åŒ–ç¢ºèªç”¨ã®å°ã•ã„ãƒ¢ãƒ‹ã‚¿ï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼šå³ä¸Šã«è¡¨ç¤ºï¼‰ */
        #binary-monitor {
            position: absolute; top: 10px; left: 10px; width: 80px; height: 60px;
            border: 1px solid #555; background: #000; z-index: 50; opacity: 0.7;
        }
    </style>
</head>
<body>

<div id="app-container">
    <video id="video-bg" autoplay playsinline muted></video>
    
    <canvas id="binary-monitor"></canvas>

    <div onclick="openSettings()" style="position:absolute; top:15px; right:15px; font-size:30px; z-index:50; cursor:pointer;">âš™ï¸</div>

    <div id="screen-title" class="screen">
        <h1>CARD MASTER</h1>
        <div id="level-list"></div>
    </div>

    <div id="screen-game" class="screen hidden">
        <button onclick="goTitle()" style="position:absolute; top:20px; left:20px; padding:5px 15px; background:rgba(0,0,0,0.5); border:1px solid #fff; color:#fff; border-radius:20px;">BACK</button>
        <div style="position:absolute; top:25px; width:100%; text-align:center; font-weight:bold;" id="game-title-text">LEVEL</div>

        <div class="slot-container">
            <div class="slot"><div class="slot-info" id="info-0">-</div></div>
            <div class="slot"><div class="slot-info" id="info-1">-</div></div>
            <div class="slot"><div class="slot-info" id="info-2">-</div></div>
            <div class="slot"><div class="slot-info" id="info-3">-</div></div>
        </div>

        <button class="btn-main judge-btn" onclick="judge()">åˆ¤ å®š !</button>
    </div>

    <div id="settings-overlay">
        <div style="display:flex; justify-content:space-between; margin-bottom:20px;">
            <h2>è¨­å®š</h2>
            <button onclick="closeSettings()" style="padding:5px 15px;">é–‰ã˜ã‚‹</button>
        </div>

        <div class="setting-box">
            <h3>ã‚«ãƒ¼ãƒ‰ç™»éŒ² (ç™½é»’2å€¤ã§è¨˜éŒ²)</h3>
            <p style="font-size:12px; color:#aaa;">å·¦ç«¯(Slot1)ã«ç½®ã„ã¦ç™»éŒ²ã€‚é»’ã‚¢ã‚¤ã‚³ãƒ³æ¨å¥¨ã€‚</p>
            <div style="display:flex; gap:5px;">
                <input type="text" id="reg-name" placeholder="åå‰" style="flex:1; padding:10px;">
                <button onclick="registerCard()" style="background:#007bff; color:white; border:none; padding:10px;">ç™»éŒ²</button>
            </div>
            <div class="card-list" id="reg-list"></div>
        </div>

        <div class="setting-box">
            <h3>å•é¡Œä½œæˆ</h3>
            <input type="text" id="lvl-name" placeholder="ã‚¿ã‚¤ãƒˆãƒ«" style="width:100%; padding:10px; box-sizing:border-box; margin-bottom:5px;">
            <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                <select id="sel-0" style="width:23%"><option>-</option></select>
                <select id="sel-1" style="width:23%"><option>-</option></select>
                <select id="sel-2" style="width:23%"><option>-</option></select>
                <select id="sel-3" style="width:23%"><option>-</option></select>
            </div>
            <button onclick="addLevel()" style="width:100%; padding:15px; background:#28a745; color:white; border:none; font-weight:bold;">è¿½åŠ </button>
        </div>

        <button onclick="resetData()" style="width:100%; padding:15px; background:#d00; color:white; border:none; margin-top:20px;">å…¨ãƒ‡ãƒ¼ã‚¿å‰Šé™¤</button>
    </div>

    <div id="result-view" onclick="this.style.display='none'">
        <div id="res-msg" style="font-size:4rem; font-weight:bold; margin-bottom:20px;"></div>
        <div>Tap to close</div>
    </div>
</div>

<canvas id="proc-canvas" style="display:none;"></canvas>

<script>
    // --- å®šæ•°ï¼šç‰©ç†æ¯”ç‡ã«åŸºã¥ãç”»é¢åˆ†å‰² ---
    // Total 312mm (63*4 + 20*3) ã«å¯¾ã™ã‚‹å‰²åˆ
    const SLOT_WIDTH_PCT = 0.2019; // 20.19%
    const GAP_PCT = 0.0641;        // 6.41%
    // å·¦ç«¯ã‹ã‚‰ã®é–‹å§‹ä½ç½® (0, 1, 2, 3ç•ªç›®)
    const SLOT_X_PCT = [
        0, 
        SLOT_WIDTH_PCT + GAP_PCT, 
        (SLOT_WIDTH_PCT + GAP_PCT) * 2, 
        (SLOT_WIDTH_PCT + GAP_PCT) * 3
    ];

    let cards = []; // {name, data(0/1 array), thumb}
    let levels = [];
    let currentTarget = [];
    let detected = ["","","",""];

    const video = document.getElementById('video-bg');
    const pCanvas = document.getElementById('proc-canvas');
    const pCtx = pCanvas.getContext('2d');
    const monCanvas = document.getElementById('binary-monitor');
    const monCtx = monCanvas.getContext('2d');

    // --- åˆæœŸåŒ– ---
    window.onload = () => {
        loadData();
        startCam();
    };

    function startCam() {
        navigator.mediaDevices.getUserMedia({
            video: { facingMode: "environment", width: { ideal: 1280 }, height: { ideal: 720 } }
        }).then(stream => {
            video.srcObject = stream;
            video.onloadedmetadata = () => {
                // å‡¦ç†è² è·è»½æ¸›ã®ãŸã‚ä½è§£åƒåº¦ã§è§£æ
                pCanvas.width = 320; 
                pCanvas.height = 180; 
                // ãƒ¢ãƒ‹ã‚¿ã‚‚åˆã‚ã›ã‚‹
                monCanvas.width = 320; monCanvas.height = 180;
                setInterval(process, 150);
            };
        }).catch(e => alert("ã‚«ãƒ¡ãƒ©èµ·å‹•ã‚¨ãƒ©ãƒ¼: " + e));
    }

    // --- ç”»åƒå‡¦ç†ã‚³ã‚¢ï¼š2å€¤åŒ–ã¨èªè­˜ ---
    function process() {
        if(cards.length === 0) return;

        // 1. æ˜ åƒå–å¾—
        pCtx.drawImage(video, 0, 0, pCanvas.width, pCanvas.height);
        
        // 2. 2å€¤åŒ–å‡¦ç† (ç™½é»’ã¯ã£ãã‚Šã•ã›ã‚‹)
        // ãƒ—ãƒ¬ã‚¤ãƒãƒƒãƒˆã®ã€ŒSlotã€ã«ç›¸å½“ã™ã‚‹ã‚¨ãƒªã‚¢ã‚’è¨ˆç®—
        const frameW = pCanvas.width; // å…¨å¹…
        const frameH = pCanvas.height;
        
        // è§£æã‚¨ãƒªã‚¢ï¼ˆç”»é¢ä¸­å¤®ã®å¸¯ï¼‰
        const scanH = frameH * 0.3; // é«˜ã•ã¯30%åˆ†ã ã‘è¦‹ã‚‹
        const scanY = (frameH - scanH) / 2;

        let detectedNow = [];

        // ãƒ¢ãƒ‹ã‚¿ç”¨ã«2å€¤åŒ–ç”»åƒã‚’æç”»
        const frameData = pCtx.getImageData(0, 0, frameW, frameH);
        const binaryFrame = binarizeImageData(frameData);
        monCtx.putImageData(binaryFrame, 0, 0); // å·¦ä¸Šã®å°çª“ã«è¡¨ç¤º

        // 3. å„ã‚¹ãƒ­ãƒƒãƒˆåˆ¤å®š
        for(let i=0; i<4; i++) {
            // ç‰©ç†æ¯”ç‡ã«åŸºã¥ã„ã¦åˆ‡ã‚Šå‡ºã—ä½ç½®ã‚’è¨ˆç®—
            // å·¦å³ã®ä½™ç™½(ã¯ã¿å‡ºã—)ã‚’è€ƒæ…®ã—ã¦ã€æ ã®ä¸­å¿ƒ 60% ç¨‹åº¦ã ã‘ã‚’åˆ¤å®šã«ä½¿ã†ï¼ˆå®‰å…¨ç­–ï¼‰
            const cx = SLOT_X_PCT[i] * frameW;     // å·¦ç«¯
            const cw = SLOT_WIDTH_PCT * frameW;    // å¹…
            
            const safeMargin = cw * 0.2; // å·¦å³20%ãšã¤æ¨ã¦ã‚‹
            const cutX = Math.floor(cx + safeMargin);
            const cutW = Math.floor(cw - safeMargin * 2);
            
            // åˆ‡ã‚Šå‡ºã—ãŸ2å€¤ãƒ‡ãƒ¼ã‚¿
            const slotData = getBinaryRegion(binaryFrame, cutX, scanY, cutW, scanH, frameW);

            // ãƒãƒƒãƒãƒ³ã‚°
            let bestName = "?";
            let minScore = Infinity; // é•ã„ã®å°‘ãªã•

            cards.forEach(c => {
                const diff = compareBinary(slotData, c.data);
                if(diff < minScore) {
                    minScore = diff;
                    // é–¾å€¤: ãƒ”ã‚¯ã‚»ãƒ«ã®ä¸ä¸€è‡´ç‡ãŒ15%æœªæº€ãªã‚‰åŒä¸€ã¨ã¿ãªã™
                    // ç™½é»’ã‚¢ã‚¤ã‚³ãƒ³ãªã‚‰ã‹ãªã‚Šå³ã—ãã—ã¦ã‚‚åˆã†ã¯ãš
                    if(diff < 0.15) bestName = c.name; 
                }
            });
            detectedNow.push(bestName);
            
            // ç”»é¢è¡¨ç¤ºæ›´æ–°
            const info = document.getElementById(`info-${i}`);
            if(info) {
                info.innerText = bestName === "?" ? "" : bestName;
                info.style.color = bestName === "?" ? "#555" : "#0f0";
            }
        }
        detected = detectedNow;
    }

    // ç”»åƒãƒ‡ãƒ¼ã‚¿ã‚’2å€¤åŒ–(0 or 255)ã™ã‚‹
    function binarizeImageData(imgData) {
        const d = imgData.data;
        const w = imgData.width;
        const h = imgData.height;
        // æ–°ã—ã„ImageDataä½œæˆ
        const bin = new ImageData(w, h);
        const bd = bin.data;

        for(let i=0; i<d.length; i+=4) {
            // ã‚°ãƒ¬ãƒ¼ã‚¹ã‚±ãƒ¼ãƒ«åŒ– (R+G+B)/3
            const gray = (d[i] + d[i+1] + d[i+2]) / 3;
            // é–¾å€¤å‡¦ç† (100ä»¥ä¸‹ãªã‚‰é»’ã€ãã‚Œä»¥å¤–ã¯ç™½)
            // é»’ã‚¢ã‚¤ã‚³ãƒ³(é»’ã‚¤ãƒ³ã‚¯)ã¯ã‹ãªã‚Šæš—ã„ã®ã§ã€é–¾å€¤100ãã‚‰ã„ã§ååˆ†
            const val = gray < 100 ? 0 : 255; 
            bd[i] = val;   // R
            bd[i+1] = val; // G
            bd[i+2] = val; // B
            bd[i+3] = 255; // Alpha
        }
        return bin;
    }

    // 2å€¤åŒ–ã•ã‚ŒãŸå…¨ä½“ç”»åƒã‹ã‚‰ã€ç‰¹å®šã‚¨ãƒªã‚¢ã®ã€Œ0(é»’)ã€ã®ãƒ‘ã‚¿ãƒ¼ãƒ³é…åˆ—ã‚’æŠ½å‡º
    // æ¯”è¼ƒé«˜é€ŸåŒ–ã®ãŸã‚ã€å˜ãªã‚‹ 0/1 ã®é…åˆ—ã«ã—ã¦è¿”ã™
    function getBinaryRegion(binImg, x, y, w, h, totalW) {
        const d = binImg.data;
        let pattern = [];
        // é–“å¼•ããªãŒã‚‰å–å¾— (é«˜é€ŸåŒ–)
        const step = 4; 
        for(let py=y; py<y+h; py+=step) {
            for(let px=x; px<x+w; px+=step) {
                const idx = (py * totalW + px) * 4;
                // é»’(0)ãªã‚‰1ã€ç™½(255)ãªã‚‰0 ã¨ã„ã†ç‰¹å¾´é‡ã«ã™ã‚‹ï¼ˆé»’ã‚¤ãƒ³ã‚¯ã®ã‚ã‚‹å ´æ‰€ãŒé‡è¦ï¼‰
                pattern.push(d[idx] === 0 ? 1 : 0);
            }
        }
        return pattern;
    }

    // 2ã¤ã®ãƒ‘ã‚¿ãƒ¼ãƒ³(0/1é…åˆ—)ã‚’æ¯”è¼ƒã—ã¦ã€ä¸ä¸€è‡´ç‡(0.0 ~ 1.0)ã‚’è¿”ã™
    function compareBinary(pat1, pat2) {
        if(pat1.length !== pat2.length) return 1.0;
        let diff = 0;
        for(let i=0; i<pat1.length; i++) {
            if(pat1[i] !== pat2[i]) diff++;
        }
        return diff / pat1.length;
    }

    // --- ãƒ‡ãƒ¼ã‚¿ç™»éŒ² ---
    function registerCard() {
        const name = document.getElementById('reg-name').value || "NoName";
        
        // ç¾åœ¨ã®ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’å–å¾—ã—ã¦2å€¤åŒ–
        pCtx.drawImage(video, 0, 0, pCanvas.width, pCanvas.height);
        const frameData = pCtx.getImageData(0, 0, pCanvas.width, pCanvas.height);
        const binaryFrame = binarizeImageData(frameData);
        
        // Slot 1 (ä¸€ç•ªå·¦) ã®ã‚¨ãƒªã‚¢ã‚’åˆ‡ã‚Šå‡ºã—
        const frameW = pCanvas.width;
        const frameH = pCanvas.height;
        const cx = SLOT_X_PCT[0] * frameW;
        const cw = SLOT_WIDTH_PCT * frameW;
        const scanH = frameH * 0.3;
        const scanY = (frameH - scanH) / 2;
        
        const safeMargin = cw * 0.2;
        const cutX = Math.floor(cx + safeMargin);
        const cutW = Math.floor(cw - safeMargin * 2);

        // ç‰¹å¾´ãƒ‡ãƒ¼ã‚¿æŠ½å‡º
        const featureData = getBinaryRegion(binaryFrame, cutX, scanY, cutW, scanH, frameW);

        // ã‚µãƒ ãƒã‚¤ãƒ«ç”¨ï¼ˆè¦‹ãŸç›®ã¯ç™½é»’ç”»åƒãã®ã¾ã¾ä¿å­˜ï¼‰
        // åˆ‡ã‚Šå‡ºã—ã¦Canvasä½œæˆ
        const tCan = document.createElement('canvas');
        tCan.width = cutW; tCan.height = scanH;
        const tCtx = tCan.getContext('2d');
        tCtx.putImageData(binaryFrame, -cutX, -scanY); // â€»ç°¡æ˜“ã‚¯ãƒªãƒƒãƒ”ãƒ³ã‚°
        // æ­£ç¢ºã«ã¯putImageDataã¯åˆ‡ã‚ŠæŠœãä½ç½®æŒ‡å®šã§ããªã„ã®ã§ã€åˆ¥é€”ImageDataä½œã‚‹ã®ãŒæ­£ã—ã„ãŒ
        // ã“ã“ã§ã¯ç°¡æ˜“çš„ã«DataURLåŒ–ã®ã¿å®Ÿè£…ï¼ˆè¡¨ç¤ºç”¨ï¼‰
        
        // ã‚µãƒ ãƒã‚¤ãƒ«ã¯å…ƒç”»åƒã‹ã‚‰åˆ‡ã‚ŠæŠœãã»ã†ãŒãã‚Œã„
        const thumbCan = document.createElement('canvas');
        thumbCan.width = cutW; thumbCan.height = scanH;
        thumbCan.getContext('2d').drawImage(pCanvas, cutX, scanY, cutW, scanH, 0, 0, cutW, scanH);

        cards.push({ name: name, data: featureData, thumb: thumbCan.toDataURL() });
        saveData();
        renderSettings();
        
        // æ¬¡ã®åå‰
        document.getElementById('reg-name').value = String.fromCharCode(name.charCodeAt(0)+1);
    }

    // --- UI/ä¿å­˜å‘¨ã‚Š (V5ãƒ™ãƒ¼ã‚¹) ---
    function openSettings() { document.getElementById('settings-overlay').classList.add('open'); }
    function closeSettings() { document.getElementById('settings-overlay').classList.remove('open'); }
    
    function renderSettings() {
        const list = document.getElementById('reg-list');
        list.innerHTML = "";
        cards.forEach((c, i) => {
            list.innerHTML += `<div class="card-thumb" onclick="delCard(${i})"><img src="${c.thumb}"><div style="position:absolute;bottom:0;background:rgba(0,0,0,0.5);color:#fff;width:100%;text-align:center;font-size:9px;">${c.name}</div><div style="position:absolute;top:0;right:0;background:red;width:15px;height:15px;font-size:10px;color:#fff;text-align:center;">Ã—</div></div>`;
        });
        
        // Selectæ›´æ–°
        for(let j=0; j<4; j++) {
            const sel = document.getElementById(`sel-${j}`);
            const old = sel.value;
            sel.innerHTML = "<option>-</option>";
            cards.forEach(c => sel.innerHTML += `<option>${c.name}</option>`);
            sel.value = old;
        }
    }

    function addLevel() {
        const t = document.getElementById('lvl-name').value || "No Title";
        const o = [0,1,2,3].map(i=>document.getElementById(`sel-${i}`).value);
        if(o.includes("-")) return alert("å…¨ã¦é¸æŠã—ã¦ãã ã•ã„");
        levels.push({title:t, order:o});
        saveData();
        renderLevels();
        alert("è¿½åŠ ã—ã¾ã—ãŸ");
    }

    function renderLevels() {
        const d = document.getElementById('level-list');
        d.innerHTML = "";
        levels.forEach((l, i) => {
            d.innerHTML += `<div class="level-item" onclick="startLevel(${i})"><span>${l.title}</span> <span onclick="event.stopPropagation();delLevel(${i})">ğŸ—‘ï¸</span></div>`;
        });
    }

    function startLevel(i) {
        currentTarget = levels[i].order;
        document.getElementById('game-title-text').innerText = levels[i].title;
        document.getElementById('screen-title').classList.add('hidden');
        document.getElementById('screen-game').classList.remove('hidden');
        video.classList.add('active');
    }
    
    function goTitle() {
        document.getElementById('screen-game').classList.add('hidden');
        document.getElementById('screen-title').classList.remove('hidden');
        video.classList.remove('active');
    }

    function judge() {
        const ok = JSON.stringify(detected) === JSON.stringify(currentTarget);
        const v = document.getElementById('result-view');
        const m = document.getElementById('res-msg');
        m.innerText = ok ? "æ­£è§£!!" : "ä¸æ­£è§£...";
        m.style.color = ok ? "#0f0" : "#f00";
        v.style.display = 'flex';
    }

    // ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–
    function saveData() {
        localStorage.setItem('cm_v6_cards', JSON.stringify(cards));
        localStorage.setItem('cm_v6_levels', JSON.stringify(levels));
    }
    function loadData() {
        const c = localStorage.getItem('cm_v6_cards');
        const l = localStorage.getItem('cm_v6_levels');
        if(c) cards = JSON.parse(c);
        if(l) levels = JSON.parse(l);
        renderSettings();
        renderLevels();
    }
    function delCard(i) { if(confirm("å‰Šé™¤?")) { cards.splice(i,1); saveData(); renderSettings(); } }
    function delLevel(i) { if(confirm("å‰Šé™¤?")) { levels.splice(i,1); saveData(); renderLevels(); } }
    function resetData() { if(confirm("å…¨æ¶ˆå»?")) { localStorage.clear(); location.reload(); } }

</script>
</body>
</html>